<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RO 攻速頻率計算機 v2.0</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 450px; }
        h2 { color: #1a73e8; text-align: center; margin-bottom: 20px; }
        .input-group { margin-bottom: 12px; }
        label { display: block; margin-bottom: 4px; font-weight: bold; font-size: 14px; }
        input[type="text"], select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
        
        .buff-section { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 15px; border: 1px solid #eee; }
        .buff-title { font-weight: bold; margin-bottom: 10px; display: block; color: #5f6368; }
        .buff-item { display: flex; align-items: center; margin-bottom: 8px; font-size: 14px; cursor: pointer; }
        .buff-item input { margin-right: 10px; width: 18px; height: 18px; }

        .result-box { margin-top: 20px; padding: 20px; background: #e8f0fe; border-radius: 10px; text-align: center; }
        .result-val { font-size: 32px; font-weight: bold; color: #1967d2; }
        .footer { font-size: 12px; color: #70757a; text-align: center; margin-top: 20px; line-height: 1.5; }
    </style>
</head>
<body>

<div class="card">
    <h2>RO 攻速計算機 v2.0</h2>
    
    <div class="input-group">
        <label>狀態模式</label>
        <select id="mode" onchange="calculate()">
            <option value="weapon">拿武器 (預設)</option>
            <option value="unarmed">空手狀態</option>
        </select>
    </div>

    <div class="input-group">
        <label>AGI (可輸入 30+25)</label>
        <input type="text" id="agi" value="1" oninput="calculate()">
    </div>

    <div class="input-group">
        <label>DEX (可輸入 10+5)</label>
        <input type="text" id="dex" value="1" oninput="calculate()">
    </div>

    <div class="input-group">
        <label>裝備加成 (%)</label>
        <input type="text" id="bonus" value="0" oninput="calculate()">
    </div>

    <div class="buff-section">
        <span class="buff-title">常用 Buff 補給</span>
        <label class="buff-item">
            <input type="checkbox" class="buff-cb" data-agi="5" data-aspd="2" onchange="calculate()">
            敏捷料理 (AGI+5, 攻速+2%)
        </label>
                <label class="buff-item">
            <input type="checkbox" class="buff-cb" data-dex="5" onchange="calculate()">
            靈巧料理 (DEX+5)
        </label>
        <label class="buff-item">
            <input type="checkbox" class="buff-cb" data-agi="30" data-dex="30" data-aspd="10" onchange="calculate()">
            補師buff (AGI+30,DEX+30,攻速+10%)
        </label>
        <label class="buff-item">
            <input type="checkbox" class="buff-cb" data-agi="0" data-aspd="10" onchange="calculate()">
            覺醒藥水 (攻速+10%)
        </label>
                <label class="buff-item">
            <input type="checkbox" class="buff-cb" data-agi="0" data-aspd="5" onchange="calculate()">
            集中藥水 (攻速+5%)
        </label>
    </div>

    <div class="result-box">
        <div style="font-size: 14px; color: #5f6368;">預測普攻頻率</div>
        <div class="result-val" id="res_f">0.00</div>
        <div style="font-size: 12px; margin-top: 5px;" id="detail_info"></div>
    </div>

    <div class="footer">
        研發者：我要叫什麼名字<br>
        基於 0.0000 殘差高精度擬合模型
    </div>
</div>

<script>
// 解析輸入公式 (例如 "30+25")
function parseExpression(str) {
    try {
        // 過濾掉非法字元，只允許數字和運算符號
        const cleanStr = str.replace(/[^-+*/().0-9]/g, '');
        // 使用 Function 代替 eval 較為安全
        return new Function('return ' + (cleanStr || '0'))();
    } catch (e) {
        return 0;
    }
}

function calculate() {
    const mode = document.getElementById('mode').value;
    
    // 解析基礎輸入
    let baseAgi = parseExpression(document.getElementById('agi').value);
    let baseDex = parseExpression(document.getElementById('dex').value);
    let baseBonus = parseExpression(document.getElementById('bonus').value);

    // 處理 Buff 累加
    let extraAgi = 0;
    let extraDex = 0;
    let extraBonus = 0;
    const checkboxes = document.querySelectorAll('.buff-cb');
    checkboxes.forEach(cb => {
        if (cb.checked) {
            extraAgi += parseFloat(cb.getAttribute('data-agi'));
            extraDex += parseFloat(cb.getAttribute('data-dex') || 0);
            extraBonus += parseFloat(cb.getAttribute('data-aspd'));
        }
    });

    const totalAgi = baseAgi + extraAgi;
    const totalDex = baseDex + extraDex;
    const totalBonus = (baseBonus + extraBonus) / 100;

    // 模型參數 [cite: 2025-09-11]
    let B, D;
    if (mode === 'unarmed') {
        B = 1.1904; D = 63.0;
    } else {
        B = 1.1109; D = 67.5;
    }

    // 計算頻率
    const S = totalAgi + (baseDex / 4);
    const f_base = B + (S / D);
    const raw_f = f_base / (1 - totalBonus);

    // 四捨五入與捨去處理
    const final_f = Math.floor(Math.round(raw_f * 1000) / 10) / 100;

    // 更新顯示
    document.getElementById('res_f').innerText = final_f.toFixed(2);
    document.getElementById('detail_info').innerText = 
        `當前總 AGI: ${totalAgi} | 當前總 DEX: ${totalDex}| 總加成: ${(totalBonus*100).toFixed(0)}%`;}

// 初始化
calculate();
</script>

</body>
</html>
